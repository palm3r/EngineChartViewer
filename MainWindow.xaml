<Window x:Class="EngineChartViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:c="clr-namespace:Visiblox.Charts;assembly=Visiblox.Charts"
        xmlns:l="clr-namespace:EngineChartViewer"
        xmlns:p="clr-namespace:EngineChartViewer.Properties"
        xmlns:s="clr-namespace:System;assembly=System"
        Title="Engine Chart Viewer v1.0"
        AllowDrop="True" Drop="Window_Drop">
  <Window.CommandBindings>
    <CommandBinding Command="{x:Static l:MainWindow.SaveAsImageCommand}"
                    Executed="SaveAsImage_Executed" CanExecute="SaveAsImage_CanExecute" />
  </Window.CommandBindings>
  <Window.InputBindings>
    <KeyBinding Modifiers="Control" Key="S"
                Command="{x:Static l:MainWindow.SaveAsImageCommand}" />
  </Window.InputBindings>
  <Window.Resources>
    <l:EnumBooleanConverter x:Key="EnumBooleanConverter" />
    <l:VisibilityBooleanConverter x:Key="VisibilityBooleanConverter" />
    <l:DataCollection x:Key="DataSource" />
    <Style TargetType="c:SplineSeries">
      <Setter Property="LineStrokeThickness" Value="2" />
    </Style>
  </Window.Resources>
  <DockPanel>
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem Command="{x:Static l:MainWindow.SaveAsImageCommand}" />
        <MenuItem Header="E_xit" Click="FileExit_Click" />
      </MenuItem>
      <MenuItem Header="_View">
        <MenuItem Header="Power" IsCheckable="True"
                  IsChecked="{Binding Path=Visibility, ElementName=PowerSeries,
                  Converter={StaticResource VisibilityBooleanConverter}}"
                  Click="Visibility_Click" />
        <MenuItem Header="Torque" IsCheckable="True"
                  IsChecked="{Binding Path=Visibility, ElementName=TorqueSeries,
                  Converter={StaticResource VisibilityBooleanConverter}}"
                  Click="Visibility_Click" />
        <MenuItem Header="Back Torque" IsCheckable="True"
                  IsChecked="{Binding Path=Visibility, ElementName=BackTorqueSeries,
                  Converter={StaticResource VisibilityBooleanConverter}}"
                  Click="Visibility_Click" />
        <Separator />
        <MenuItem Header="KW" IsCheckable="True"
                  IsChecked="{Binding Path=PowerUnit, Converter={StaticResource EnumBooleanConverter},
                  ConverterParameter=KW}"
                  Click="ChangeUnit_Click" />
        <MenuItem Header="PS" IsCheckable="True"
                  IsChecked="{Binding Path=PowerUnit, Converter={StaticResource EnumBooleanConverter},
                  ConverterParameter=PS}"
                  Click="ChangeUnit_Click" />
        <MenuItem Header="BHP" IsCheckable="True"
                  IsChecked="{Binding Path=PowerUnit, Converter={StaticResource EnumBooleanConverter},
                  ConverterParameter=BHP}"
                  Click="ChangeUnit_Click" />
        <Separator />
        <MenuItem Header="Nm" IsCheckable="True"
                  IsChecked="{Binding Path=TorqueUnit, Converter={StaticResource EnumBooleanConverter},
                  ConverterParameter=NM}"
                  Click="ChangeUnit_Click" />
        <MenuItem Header="Kgm" IsCheckable="True"
                  IsChecked="{Binding Path=TorqueUnit, Converter={StaticResource EnumBooleanConverter},
                  ConverterParameter=KGM}"
                  Click="ChangeUnit_Click" />
      </MenuItem>
    </Menu>
    <DockPanel x:Name="imageFrame" DockPanel.Dock="Top">
      <TextBlock x:Name="fileNameTB" DockPanel.Dock="Top"
                  Margin="4" FontSize="14" FontWeight="Bold"
                  Text="Drop engine.ini here" />
      <TextBlock x:Name="maxPowerTB" DockPanel.Dock="Top" Margin="4,0" />
      <TextBlock x:Name="maxTorqueTB" DockPanel.Dock="Top" Margin="4,0" />

      <c:Chart x:Name="chart" Margin="4"
                LegendPosition="LeftInside" LegendVerticalAlignment="Top">
        <c:Chart.XAxis>
          <c:LinearAxis x:Name="RpmAxis" Title="RPM" ShowGridlines="True" />
        </c:Chart.XAxis>
        <c:Chart.YAxis>
          <c:LinearAxis x:Name="PowerAxis" Title="Power (KW)"
                        Foreground="Red" ShowGridlines="True"
                        ShowMajorTicks="True" ShowMinorTicks="True" />
        </c:Chart.YAxis>
        <c:Chart.SecondaryYAxis>
          <c:LinearAxis x:Name="TorqueAxis" Title="Torque (Nm)"
                        Foreground="Blue" ShowGridlines="False"
                        ShowMajorTicks="True" ShowMinorTicks="True" />
        </c:Chart.SecondaryYAxis>
        <c:Chart.Series>
          <c:SplineSeries x:Name="TorqueSeries" LineStroke="#4040FF" LineStrokeThickness="2">
            <c:SplineSeries.DataSeries>
              <c:BindableDataSeries Title="Torque" ItemsSource="{StaticResource DataSource}"
                                    YValueBinding="{Binding Path=Torque}"
                                    XValueBinding="{Binding Path=RPM}" />
            </c:SplineSeries.DataSeries>
          </c:SplineSeries>
          <c:SplineSeries x:Name="BackTorqueSeries" LineStroke="#40FF40" LineStrokeThickness="2">
            <c:SplineSeries.DataSeries>
              <c:BindableDataSeries Title="Back Torque" ItemsSource="{StaticResource DataSource}"
                                    YValueBinding="{Binding Path=BackTorque}"
                                    XValueBinding="{Binding Path=RPM}" />
            </c:SplineSeries.DataSeries>
          </c:SplineSeries>
          <c:SplineSeries x:Name="PowerSeries" LineStroke="#FF4040" LineStrokeThickness="2">
            <c:SplineSeries.DataSeries>
              <c:BindableDataSeries Title="Power" ItemsSource="{StaticResource DataSource}"
                                    YValueBinding="{Binding Path=Power}"
                                    XValueBinding="{Binding Path=RPM}" />
            </c:SplineSeries.DataSeries>
          </c:SplineSeries>
        </c:Chart.Series>
      </c:Chart>
    </DockPanel>
  </DockPanel>
</Window>
